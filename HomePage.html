<html>
<style>
/* Style the tab */
div.tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
div.tab button {
    background-color: inherit;
    float: left;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
	
}

/* Change background color of buttons on hover */
div.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current tablink class */
div.tab button.active {
    background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
    display: none;
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-top: none;
}


<style>

body {
  font: 13px sans-serif;
}

p {
    padding-right: 20px;
   
    padding-left: 30px;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: #3d3d5c;
}

.bar:hover {
  fill: #cf4b35;
}

.x.axis path {
  display: none;
}

.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
</style>

</style>
<script>
function openCity(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}
</script>
<body>

<div class="tab" >
  <button class="tablinks" onclick="openCity(event, 'LendingClubAnalysis')">Home</button>
  <button class="tablinks" onclick="location.href='InterestRateByGrade.html' ;">InterestRate By Grade</button>
  <button class="tablinks" onclick="location.href='AnalysisByLoanYear.html' ;">Analysis By Loan Year</button>
  <button class="tablinks" onclick="location.href='LoanAmountByGrade.html' ;">Loan Amounts By Grade</button>
</div>
<div >
<img src="images/Loanspic.jpg" alt="Loans By Lending Club" width=150 height=100 align="left">
<img src="images/Loanspic.jpg" alt="Loans By Lending Club" width=150 height=100 align="right">
</div>
<div id="LendingClubAnalysis"  align="center">
 <h1><b><font>Lending Club Loan Analysis</font></b></h1>
</div>

<div style="text-align:justify">
<p>
<br>
Lending Club is a US peer-to-peer lending company, headquartered in San Francisco, California. It was the first peer-to-peer lender to register its offerings as securities with the Securities and Exchange Commission (SEC), and to offer loan trading on a secondary market. 
</p>
<p style="text-align:justify">
Lending Club operates an online lending platform that enables borrowers to obtain a loan, and investors to purchase notes backed by payments made on loans. Lending Club is the world's largest peer-to-peer lending platform.
<a href=http://www.lendingclub.com> <font color="#4d4d4d">Visit Lending Club Website</font></a>
</p>
<p>
<b>
How did Lending Club evolve  over time? The Chart below shows the exponential growth of Lending Club.</b>
</p>
<p>
Click on the button <b>AboutVisualization</b> in the bottom to know more
</p>
</div>

<div id=chart align=center>
<p><h4> Lending Club Loan data analysis by Year</h4></p>
<svg id=LoanAmount></svg>
</div>
<footer>
<div class="tab">
  <button class="tablinks" onclick="openCity(event, 'AboutTheVisualization')"><b>AboutTheVisualization</b></button>
 
</div>

<div id="AboutTheVisualization" class="tabcontent" style="text-align:justify">
<div>
<p>
The visualization project is following the Interactive slideshow narrative visualization structure.
This is the <b>Opening Slide</b> and all the other others follow the same layout.
This page represents the Analysis of Loan amounts by Lending club from Inception to 2016.
The Slide <b>InterestRate By Grade</b>, shows how Interest Rate varies and how they impact in the calculation of Monthly Payments
The Slide <b>AnalysisByLoanYear</b>, shows the variation between lending amounts over time and for what purposes have the loans been taken
The Slide <b>LoanAmountByGrade</b>, shows the Loans amounts by Grade from Inception to 2016 in a stacked bar chart.
GradeA loan is given to a borrower with excellent credit history while Grade G is given to a person which a low credit score.

</p>
<p>
<b>User Interface Events</b>
The navigation buttons at the top will help user navigate between pages.
User interacts by clicking on the button or menu items to navigate to various part of this visualzation story. 
The hover event allows proper positioning of the tooltip.
</p>
<p>
<b>Annotations</b>
The annotation is represented by tooltip when mouse is hovered over the bars in the chart. 
The labels along the X and Y axis provides additional annotations for the chart.
</p>
<p>
<b>Triggers</b>
The mouse click event acts as a trigger to faciliate navigation in this visualization presentation. 
The mouse hover (mouseover) event is a trigger for the tooltip in the bar chart. 
The mouse over event triggers the ToopTip to showup on the top of the Bar.</p>
<p>
<b>Parameters</b>
This section is hyper linked to all the pages of the Narrative Visualization via Menu Buttons on the top. 
The name of the target section is passed as an input paramter to the buttons and navgiation bar items. 
The chart uses the D3 Library. 
The data for the chart is passed from a TSV file which is stored in the data folder, which is then read by D3 for rendering axis,bars and tooltips for the chart. 
</p>
<p>
<b>Data Preparation:</b> 
Lending club data was downloaded from here <a href= "https://www.lendingclub.com/info/download-data.action"> Download Lending Club Data </a>, from inception of Lending club in 2007 to 2017Q1 in the format of CSV files. 
Data was cleaned by removing the headers and footers from all the 9 files using PySpark  and created a clean file with first row as the header and all the remaining 1 million rows as the values. Data with null values and data for year 2017 was filtered to give a better perspective for the data. 
Then the TSV file was created by SparkDataFrame
</p>
</div>
</div>


  <p><a href= "https://www.linkedin.com/in/sravan-kumar-gardas/">Author Sravan Gardas <a></p>
  <p> CS498 Data Visualization UIUC</p>
</footer>

</body>

<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="scripts/d3_tip.js"></script>
<script>

var margin = {top: 20, right: 20, bottom: 100, left: 90},
    width = 960 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

var formatPercent = d3.format("s");



var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    //.tickFormat(formatPercent)
	.tickFormat (function (d) { return formatPercent(d).replace('G', 'B'); }); 
	
	 

var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<strong>Loan Amount$:</strong> <span style='color:#cf4b35'>" +d.LoanAmnt + "</span>";
  })

var svg = d3.select("#LoanAmount")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

svg.call(tip);

d3.tsv("data/LoanAmt_ByYear.tsv", type, function(error, data) {
  x.domain(data.map(function(d) { return d.YearOfIssue; }));
  y.domain([0, d3.max(data, function(d) { return d.LoanAmnt; })]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)  
	  .selectAll("text")
      .style("font-size", "14px")
      .style("text-anchor", "end")
      .attr("dx", "-.8em")//this is moving the axis lable
      .attr("dy", "-.15em")//this is moving to after the tick
      .attr("transform", "rotate(-65)" );

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .selectAll("text")
	  .style("font-size", "12px")
     .attr("transform", "rotate(0)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end");

      

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.YearOfIssue); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.LoanAmnt); })
      .attr("height", function(d) { return height - y(d.LoanAmnt); })
	 // .attr("id",d.YearOfIssue)
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide);
	  //.on('click',function(){ d3.select("svg").remove();});
	
	//axis label
    svg.append("text")
        .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom-50) + ")")
		.attr("dx", "-.55em")
        .style("text-anchor", "middle")
		.attr("font-weight", "bold")
		.style("font-size", "12px")
        .text("Loan Year");
	// y axis label	
svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 15 - margin.left)
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
		.attr("font-weight", "bold")
		.style("font-size", "12px")
        .text("Loan Amount $ (Billions)");

});

function type(d) {
  d.LoanAmnt = +d.LoanAmnt;
  return d;
}

</script>

</html>